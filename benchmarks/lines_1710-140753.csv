Line,Times Executed,Total Execution Time,Time per Execution,% of Function Execution Time,Function,Code
1045,1,5272015.0,5272015.0,36.6,produce_summary,"gene_tissue_expression_extremes = pool.map(get_tissue_expression, genes_tissues)"
1055,1,789705.0,789705.0,5.5,produce_summary,pool = multiprocessing.Pool(processes=num_processes)
977,22069,760196.0,34.4,5.3,produce_summary,"gene_stat = gene_index_db.execute(query_str, [gene]).fetchone()"
949,1,741052.0,741052.0,5.1,produce_summary,"gene_df = pandas.read_table(expression_table_fp, index_col=""Description"", engine='c', compression=None, memory_map=True)"
1044,1,645808.0,645808.0,4.5,produce_summary,pool = multiprocessing.Pool(processes=num_processes)
1070,22069,471711.0,21.4,3.3,produce_summary,summ_writer.writerow(line)
1036,22069,334005.0,15.1,2.3,produce_summary,bar.update(i)
1375,22069,216534.0,9.8,16.5,parse_eqtls_files,"bisect.insort(p_values, float(row[3]))"
1428,1,211998.0,211998.0,16.2,parse_eqtls_files,adjusted_p_values = compute_adj_pvalues(p_values)
1093,1,211966.0,211966.0,100.0,compute_adj_pvalues,"return R.r['p.adjust'](p_values, method='BH')"
1412,2,189665.0,94832.5,14.5,parse_eqtls_files,"'frag': cur.fetchone()[0],"
1430,22069,143655.0,6.5,11.0,parse_eqtls_files,p_values_map[p_values[i]] = adjusted_p_values[i]
1047,30096,134075.0,4.5,0.9,produce_summary,gene_exp[genes_tissues[i][0]][genes_tissues[i][1]] = gene_tissue_expression_extremes[i]
958,22070,126963.0,5.8,0.9,produce_summary,"for i, row in enumerate(ereader,1):"
998,22069,124390.0,5.6,0.9,produce_summary,cell_lines = list(genes[snp][gene])
1066,22069,119113.0,5.4,0.8,produce_summary,"line.insert(12, hic_dict[(snp, gene)][0])"
967,22069,116034.0,5.3,0.8,produce_summary,qvalue = p_values[float(p_val)]
1410,2,94864.0,47432.0,7.2,parse_eqtls_files,snps[snp]['locus']))
1046,30097,94282.0,3.1,0.7,produce_summary,for i in range(len(genes_tissues)):
1043,30724,93246.0,3.0,0.6,produce_summary,"genes_tissues = [(gene, tissue) for gene in genes_from_file for tissue in tissues_from_file]"
1056,1,92125.0,92125.0,0.6,produce_summary,"gene_expression_extremes = pool.map(get_gene_expression_extremes, genes_from_file)"
1068,22069,91704.0,4.2,0.6,produce_summary,line.append(gene_exp[gene][tissue])
1067,22069,91504.0,4.1,0.6,produce_summary,"line.insert(13, hic_dict[(snp, gene)][1])"
980,22069,88579.0,4.0,0.6,produce_summary,if abs(gene_stat[2] - gene_stat[1]) > max_length:
1035,22069,81538.0,3.7,0.6,produce_summary,distance_from_snp])
981,22069,81219.0,3.7,0.6,produce_summary,"if gene_stat[0].startswith(""chr""):"
1370,22070,81197.0,3.7,6.2,parse_eqtls_files,"for i, row in enumerate(ereader, 1):"
1007,22069,80213.0,3.6,0.6,produce_summary,"to_cell_line = ', '.join(cell_lines)"
1071,22069,79836.0,3.6,0.6,produce_summary,if line[9] < fdr_threshold:
1358,1,79625.0,79625.0,6.1,parse_eqtls_files,"genes = parse_genes_files(os.path.join(file_path, 'genes.txt'))"
1019,22069,79580.0,3.6,0.6,produce_summary,if not tissue in gene_exp[gene]:
1069,22069,79287.0,3.6,0.6,produce_summary,line.extend(gene_exp_extr[gene])
1020,22069,77383.0,3.5,0.5,produce_summary,gene_exp[gene][tissue] = 'NA'
971,22069,76336.0,3.5,0.5,produce_summary,"""fragments"": snps[snp][""fragments""]}"
1017,22069,76087.0,3.4,0.5,produce_summary,if not gene in gene_exp:
993,22069,74764.0,3.4,0.5,produce_summary,"cis = gene_chr == snp_info[""chr""] and ("
969,22069,74024.0,3.4,0.5,produce_summary,"""chr"": snps[snp][""chr""],"
970,22069,71680.0,3.2,0.5,produce_summary,"""locus"": snps[snp][""locus""],"
1011,22069,71608.0,3.2,0.5,produce_summary,"elif(not snp_info[""chr""] == gene_chr):"
1063,22069,71325.0,3.2,0.5,produce_summary,snp = line[0]
996,22069,71047.0,3.2,0.5,produce_summary,cell_lines = ''
1062,22070,70882.0,3.2,0.5,produce_summary,for line in to_file:
964,22069,70708.0,3.2,0.5,produce_summary,genes_from_file.append(gene)
1065,22069,69621.0,3.2,0.5,produce_summary,tissue = line[7]
1064,22069,69242.0,3.1,0.5,produce_summary,gene = line[3]
959,22069,69168.0,3.1,0.5,produce_summary,snp = row[0]
965,22069,69139.0,3.1,0.5,produce_summary,tissues_from_file.append(tissue)
1021,22069,68880.0,3.1,0.5,produce_summary,"to_file.append([snp,"
1009,22069,68574.0,3.1,0.5,produce_summary,"if(gene_chr == ""NA""):"
987,22069,68493.0,3.1,0.5,produce_summary,max_length = gene_stat[2] - gene_stat[1]
966,22069,68116.0,3.1,0.5,produce_summary,snps_from_file.append(snp)
968,22069,67916.0,3.1,0.5,produce_summary,snp_info = {
1022,22069,67909.0,3.1,0.5,produce_summary,"snp_info[""chr""],"
984,22069,67789.0,3.1,0.5,produce_summary,gene_chr = gene_stat[0]
1001,22069,67776.0,3.1,0.5,produce_summary,p_thresh = p_thresh
1023,22069,67723.0,3.1,0.5,produce_summary,"snp_info[""locus""],"
986,22069,67323.0,3.1,0.5,produce_summary,gene_end = gene_stat[2]
1002,22069,66990.0,3.0,0.5,produce_summary,interaction = True
985,22069,66657.0,3.0,0.5,produce_summary,gene_start = gene_stat[1]
1003,22069,66291.0,3.0,0.5,produce_summary,if cis:
1008,22069,65984.0,3.0,0.5,produce_summary,distance_from_snp = 0
1024,22069,65629.0,3.0,0.5,produce_summary,"gene,"
1033,22069,65623.0,3.0,0.5,produce_summary,"p_thresh,"
1034,22069,65612.0,3.0,0.5,produce_summary,"interaction,"
988,22069,65603.0,3.0,0.5,produce_summary,if include_p_thresh:
1025,22069,65566.0,3.0,0.5,produce_summary,"gene_chr,"
997,22069,65540.0,3.0,0.5,produce_summary,try:
972,22069,65426.0,3.0,0.5,produce_summary,"gene_chr = ""NA"""
1026,22069,65349.0,3.0,0.5,produce_summary,"gene_start,"
1030,22069,65312.0,3.0,0.5,produce_summary,"qvalue,"
1032,22069,65284.0,3.0,0.5,produce_summary,"to_cell_line,"
1031,22069,65226.0,3.0,0.5,produce_summary,"effect_size,"
1029,22069,65180.0,3.0,0.5,produce_summary,"p_val,"
973,22069,65084.0,2.9,0.5,produce_summary,"gene_start = ""NA"""
1028,22069,65011.0,2.9,0.5,produce_summary,"tissue,"
991,22069,64966.0,2.9,0.5,produce_summary,"p_thresh = ""NA"""
960,22069,64922.0,2.9,0.5,produce_summary,gene = row[1]
1027,22069,64897.0,2.9,0.5,produce_summary,"gene_end,"
963,22069,64878.0,2.9,0.5,produce_summary,effect_size = row[4]
975,22069,64742.0,2.9,0.4,produce_summary,max_length = 0
974,22069,64734.0,2.9,0.4,produce_summary,"gene_end = ""NA"""
961,22069,64575.0,2.9,0.4,produce_summary,tissue = row[2]
962,22069,64485.0,2.9,0.4,produce_summary,p_val = row[3]
1374,22069,63729.0,2.9,4.9,parse_eqtls_files,effect_size = float(row[4])
1006,21019,63305.0,3.0,0.4,produce_summary,interaction = False
1429,22070,51864.0,2.3,4.0,parse_eqtls_files,for i in range(len(p_values)):
1376,22069,46642.0,2.1,3.6,parse_eqtls_files,if not snp in snps:
1371,22069,44241.0,2.0,3.4,parse_eqtls_files,snp = row[0]
1372,22069,40898.0,1.9,3.1,parse_eqtls_files,gene = row[1]
1373,22069,40735.0,1.8,3.1,parse_eqtls_files,tissue = row[2]
1012,12318,37330.0,3.0,0.3,produce_summary,"distance_from_snp = ""NA""  # Not applicable to trans interactions"
994,9751,32018.0,3.3,0.2,produce_summary,"(snp_info[""locus""] > gene_start - 1000000) and"
1013,9751,31121.0,3.2,0.2,produce_summary,"elif(snp_info[""locus""] < gene_start):"
1050,1,25073.0,25073.0,0.2,produce_summary,"hic_data = pool.map(calc_hic_contacts, snps_genes)"
1014,6056,19334.0,3.2,0.1,produce_summary,"distance_from_snp = gene_start - snp_info[""locus""]"
995,4383,14106.0,3.2,0.1,produce_summary,"(snp_info[""locus""] < gene_end + 1000000))"
1015,3695,11803.0,3.2,0.1,produce_summary,"elif(snp_info[""locus""] > gene_end):"
1016,3695,11690.0,3.2,0.1,produce_summary,"distance_from_snp = snp_info[""locus""] - gene_end"
1306,2018,6754.0,3.3,14.7,parse_genes_files,for row in greader:
1311,2017,4512.0,2.2,9.8,parse_genes_files,interactions_replicates = len(row[4].split())
1317,2017,4060.0,2.0,8.8,parse_genes_files,'rep_present': interactions_replicates}
1310,2017,3898.0,1.9,8.5,parse_genes_files,interactions = int(row[3])
1312,2017,3838.0,1.9,8.3,parse_genes_files,replicates_count = int(row[5])
1053,627,3512.0,5.6,0.0,produce_summary,hic_dict[snps_genes[i]] = hic_data[i]
1004,1050,3210.0,3.1,0.0,produce_summary,interaction = True
1052,628,2995.0,4.8,0.0,produce_summary,for i in range(len(snps_genes)):
1424,1,2937.0,2937.0,0.2,parse_eqtls_files,"shutil.copyfileobj(efile, joined_eqtl_file)"
1059,627,2908.0,4.6,0.0,produce_summary,gene_exp_extr[genes_from_file[i]] = gene_expression_extremes[i]
1314,2017,2710.0,1.3,5.9,parse_genes_files,genes[snp][gene][cell_line] = {
1058,628,2559.0,4.1,0.0,produce_summary,for i in range(len(genes_from_file)):
1307,2017,2496.0,1.2,5.4,parse_genes_files,gene = row[1]
1315,2017,2270.0,1.1,4.9,parse_genes_files,"'interactions': interactions,"
1313,2017,2182.0,1.1,4.7,parse_genes_files,try:
1049,629,2167.0,3.4,0.0,produce_summary,"snps_genes = [(snp, gene) for snp in snps_from_file for gene in genes_from_file]"
1308,2017,2155.0,1.1,4.7,parse_genes_files,snp = row[0]
1018,627,2127.0,3.4,0.0,produce_summary,gene_exp[gene] = {}
1309,2017,2081.0,1.0,4.5,parse_genes_files,cell_line = row[2]
1316,2017,2070.0,1.0,4.5,parse_genes_files,"'replicates': replicates_count,"
1038,1,1919.0,1919.0,0.0,produce_summary,genes_from_file = dict.fromkeys(genes_from_file).keys()
953,1,1817.0,1817.0,0.0,produce_summary,bar  = progressbar.ProgressBar(max_value = progressbar.UnknownLength)
1041,1,1233.0,1233.0,0.0,produce_summary,current_process = psutil.Process()
1039,1,1201.0,1201.0,0.0,produce_summary,tissues_from_file = dict.fromkeys(tissues_from_file).keys()
1318,663,1085.0,1.6,2.4,parse_genes_files,except KeyError:
1040,1,998.0,998.0,0.0,produce_summary,snps_from_file = dict.fromkeys(snps_from_file).keys()
1326,663,975.0,1.5,2.1,parse_genes_files,'rep_present': interactions_replicates}
1322,663,939.0,1.4,2.0,parse_genes_files,genes[snp][gene] = {}
1415,2,876.0,438.0,0.1,parse_eqtls_files,conn.close()
1323,663,857.0,1.3,1.9,parse_genes_files,genes[snp][gene][cell_line] = {
1321,663,822.0,1.2,1.8,parse_genes_files,if not gene in genes[snp]:
1319,663,802.0,1.2,1.7,parse_genes_files,if not snp in genes:
1324,663,728.0,1.1,1.6,parse_genes_files,"'interactions': interactions,"
1325,663,717.0,1.1,1.6,parse_genes_files,"'replicates': replicates_count,"
1394,1,373.0,373.0,0.0,parse_eqtls_files,"snp_index.execute(""SELECT * FROM snps WHERE rsID=?"", (snp,))"
941,5,349.0,69.8,0.0,produce_summary,"for res in gene_index_db.execute(""PRAGMA table_info(genes)"")]"
1403,2,243.0,121.5,0.0,parse_eqtls_files,"lib_fp, enzyme, 'dna.fragments.db'))"
1344,1,215.0,215.0,0.0,parse_eqtls_files,snp_dp = sqlite3.connect(snp_database_fp)
1421,1,160.0,160.0,0.0,parse_eqtls_files,"joined_eqtl_file = open(os.path.join(output_dir, 'eqtls.txt'), 'w')"
938,1,130.0,130.0,0.0,produce_summary,gene_index_db = sqlite3.connect(gene_database_fp)
910,1,128.0,128.0,0.0,produce_summary,"summary = open(output_dir + ""/summary.txt"", 'w')"
1418,1,109.0,109.0,0.0,parse_eqtls_files,snp_dp.close()
1078,1,78.0,78.0,0.0,produce_summary,sig_file.close()
908,1,77.0,77.0,0.0,produce_summary,if not os.path.isdir(output_dir):
1042,1,75.0,75.0,0.0,produce_summary,num_processes = len(current_process.cpu_affinity())
1347,1,75.0,75.0,0.0,parse_eqtls_files,gene_dp = sqlite3.connect(gene_database_fp)
1077,1,64.0,64.0,0.0,produce_summary,summary.close()
951,1,61.0,61.0,0.0,produce_summary,"eqtlfile = open(os.path.join(output_dir, 'eqtls.txt'), 'r')"
935,1,60.0,60.0,0.0,produce_summary,"sig_file = open(os.path.join(output_dir, 'significant_eqtls.txt'), 'w')"
1359,1,48.0,48.0,0.0,parse_eqtls_files,"genes_files.append(os.path.isfile(os.path.join(file_path, 'genes.txt')))"
1356,1,41.0,41.0,0.0,parse_eqtls_files,"if os.path.isfile(os.path.join(file_path, 'genes.txt')):"
939,1,38.0,38.0,0.0,produce_summary,gene_index_db.text_factory = str
1427,1,36.0,36.0,0.0,parse_eqtls_files,print('Adjusting p values...')
1377,1,32.0,32.0,0.0,parse_eqtls_files,"if os.path.isfile(os.path.join(file_path, 'snps.txt')):"
934,1,29.0,29.0,0.0,produce_summary,summ_writer.writerow(summ_header)
911,1,24.0,24.0,0.0,produce_summary,"summ_writer = csv.writer(summary, delimiter='\t')"
1416,1,22.0,22.0,0.0,parse_eqtls_files,eqtlfile.close()
1367,1,19.0,19.0,0.0,parse_eqtls_files,"eqtlfile =  open(eqtls_file, 'r')"
937,1,18.0,18.0,0.0,produce_summary,sigwriter.writerow(summ_header)
1423,1,16.0,16.0,0.0,parse_eqtls_files,"with open(eqtls_file, 'r') as efile:"
1405,2,16.0,8.0,0.0,parse_eqtls_files,cur = conn.cursor()
1411,2,15.0,7.5,0.0,parse_eqtls_files,snps[snp]['fragments'].append({
1414,2,14.0,7.0,0.0,parse_eqtls_files,cur.close()
1354,1,13.0,13.0,0.0,parse_eqtls_files,"print('\tParsing eQTL file {} of {}'.format(file_count, len(eqtls_files)))"
1305,1,12.0,12.0,0.0,parse_genes_files,"greader = csv.reader(genefile, delimiter = '\t')"
1335,1,12.0,12.0,0.0,parse_eqtls_files,"print(""Parsing eQTLs..."")"
952,1,12.0,12.0,0.0,produce_summary,"ereader = csv.reader(eqtlfile, delimiter = '\t')"
1431,1,11.0,11.0,0.0,parse_eqtls_files,"return (p_values_map, snps, genes)"
1304,1,11.0,11.0,0.0,parse_genes_files,"genefile = open(gene_file, 'r')"
1395,1,11.0,11.0,0.0,parse_eqtls_files,from_db = snp_index.fetchone()
1417,1,11.0,11.0,0.0,parse_eqtls_files,snp_index.close()
1402,2,10.0,5.0,0.0,parse_eqtls_files,conn = sqlite3.connect(os.path.join(
1404,2,10.0,5.0,0.0,parse_eqtls_files,conn.text_factory = str
1413,2,10.0,5.0,0.0,parse_eqtls_files,'enzyme': enzyme})
1057,1,9.0,9.0,0.0,produce_summary,gene_exp_extr = {}
1400,3,9.0,3.0,0.0,parse_eqtls_files,enzymes = [e.strip() for e in enzymes]
1401,3,8.0,2.7,0.0,parse_eqtls_files,for enzyme in enzymes:
1051,1,7.0,7.0,0.0,produce_summary,hic_dict = {}
1346,1,7.0,7.0,0.0,parse_eqtls_files,snp_index = snp_dp.cursor()
1422,2,7.0,3.5,0.0,parse_eqtls_files,for eqtls_file in eqtls_files:
1368,1,7.0,7.0,0.0,parse_eqtls_files,"ereader = csv.reader(eqtlfile, delimiter='\t')"
933,1,7.0,7.0,0.0,produce_summary,'Min_Expression_Level']
940,1,7.0,7.0,0.0,produce_summary,col_names = [res[1]
936,1,6.0,6.0,0.0,produce_summary,"sigwriter = csv.writer(sig_file, delimiter='\t')"
1303,2,5.0,2.5,0.0,parse_genes_files,for gene_file in genes_files.split(' '):
1345,1,5.0,5.0,0.0,parse_eqtls_files,snp_dp.text_factory = str
1352,2,5.0,2.5,0.0,parse_eqtls_files,for eqtls_file in eqtls_files:
1408,2,5.0,2.5,0.0,parse_eqtls_files,"""AND start<=? AND end>=?"", (snps[snp]['chr'],"
942,1,5.0,5.0,0.0,produce_summary,"include_p_thresh = ""p_thresh"" in col_names"
950,1,5.0,5.0,0.0,produce_summary,gene_exp = {}
1079,1,4.0,4.0,0.0,produce_summary,return (num_sig)
1399,1,4.0,4.0,0.0,parse_eqtls_files,"enzymes = restriction_enzymes.split(',')"
1406,2,4.0,2.0,0.0,parse_eqtls_files,cur.execute(
1409,2,4.0,2.0,0.0,parse_eqtls_files,"snps[snp]['locus'],"
906,1,4.0,4.0,0.0,produce_summary,genes_global = genes
1348,1,3.0,3.0,0.0,parse_eqtls_files,gene_dp.text_factory = str
1349,1,3.0,3.0,0.0,parse_eqtls_files,gene_index = snp_dp.cursor()
1353,1,3.0,3.0,0.0,parse_eqtls_files,file_path = eqtls_file[:len(eqtls_file)-9]
1426,1,3.0,3.0,0.0,parse_eqtls_files,p_values_map = {}
1396,1,3.0,3.0,0.0,parse_eqtls_files,"snps[snp] = {'chr': from_db[1],"
1407,2,3.0,1.5,0.0,parse_eqtls_files,"""SELECT fragment FROM fragments WHERE chr=? ""+\"
907,1,3.0,3.0,0.0,produce_summary,num_sig = {}  # Number of eQTLs deemed significant under the given threshold
912,1,3.0,3.0,0.0,produce_summary,"summ_header = ['SNP',"
913,1,3.0,3.0,0.0,produce_summary,"'SNP_Chromosome',"
914,1,3.0,3.0,0.0,produce_summary,"'SNP_Locus',"
916,1,3.0,3.0,0.0,produce_summary,"'Gene_Chromosome',"
917,1,3.0,3.0,0.0,produce_summary,"'Gene_Start',"
918,1,3.0,3.0,0.0,produce_summary,"'Gene_End',"
919,1,3.0,3.0,0.0,produce_summary,"'Tissue',"
920,1,3.0,3.0,0.0,produce_summary,"'p-value',"
922,1,3.0,3.0,0.0,produce_summary,"'Effect_Size',"
923,1,3.0,3.0,0.0,produce_summary,"'Cell_Lines',"
924,1,3.0,3.0,0.0,produce_summary,"'Cell_Lines_HiC_scores',"
926,1,3.0,3.0,0.0,produce_summary,"'GTEx_cis_p_Threshold',"
927,1,3.0,3.0,0.0,produce_summary,"'cis_SNP-gene_interaction',"
928,1,3.0,3.0,0.0,produce_summary,"'SNP-gene_Distance',"
929,1,3.0,3.0,0.0,produce_summary,"'Expression_Level_In_eQTL_Tissue',"
931,1,3.0,3.0,0.0,produce_summary,"'Maximum_Expression_Level',"
932,1,3.0,3.0,0.0,produce_summary,"'Min_Expressed_Tissue',"
943,1,3.0,3.0,0.0,produce_summary,if include_p_thresh:
946,1,3.0,3.0,0.0,produce_summary,"query_str = ""SELECT chr, start, end FROM genes WHERE symbol=?"""
954,1,3.0,3.0,0.0,produce_summary,to_file = []
955,1,3.0,3.0,0.0,produce_summary,genes_from_file = []
956,1,3.0,3.0,0.0,produce_summary,tissues_from_file = []
957,1,3.0,3.0,0.0,produce_summary,snps_from_file = []
1320,1,2.0,2.0,0.0,parse_genes_files,genes[snp] = {}
1336,1,2.0,2.0,0.0,parse_eqtls_files,eqtls = {}
1337,1,2.0,2.0,0.0,parse_eqtls_files,snps = {}
1338,1,2.0,2.0,0.0,parse_eqtls_files,genes = {}
1339,1,2.0,2.0,0.0,parse_eqtls_files,p_values = []  # A sorted list of all p-values for use computing FDR
1340,1,2.0,2.0,0.0,parse_eqtls_files,num_tests = 0  # Total number of tests done
1341,1,2.0,2.0,0.0,parse_eqtls_files,num_sig = {}  # Number of eQTLs deemed significant under the given threshold
1351,1,2.0,2.0,0.0,parse_eqtls_files,genes_files = []
1355,1,2.0,2.0,0.0,parse_eqtls_files,file_count += 1
1397,1,2.0,2.0,0.0,parse_eqtls_files,"'locus': from_db[2],"
1398,1,2.0,2.0,0.0,parse_eqtls_files,'fragments': []} #Handle fragments from multiple REs
915,1,2.0,2.0,0.0,produce_summary,"'Gene_Name',"
921,1,2.0,2.0,0.0,produce_summary,"'Adj_p-value',"
925,1,2.0,2.0,0.0,produce_summary,"'HiC_Contact_Score',"
930,1,2.0,2.0,0.0,produce_summary,"'Max_Expressed_Tissue',"
1302,1,1.0,1.0,0.0,parse_genes_files,genes = {}
1328,1,1.0,1.0,0.0,parse_genes_files,return genes
1350,1,1.0,1.0,0.0,parse_eqtls_files,file_count = 1
